# Studora Platform - Future Enhancements

## Overview
This document outlines planned improvements and features to be implemented **after MVP launch**. These enhancements are intentionally deferred to maintain focus on core functionality and ensure a stable foundation before adding complexity.

---

## Table of Contents
1. [Event-Driven Architecture](#1-event-driven-architecture)
2. [API Versioning](#2-api-versioning)
3. [Additional Enhancements](#3-additional-enhancements)
4. [Completed Enhancements](#completed-enhancements)

---

## 1. Event-Driven Architecture

### Current State
Services directly call other services for related updates, creating tight coupling:

```java
// Current approach in QuestaoService
public QuestaoDetailDto update(Long id, QuestaoUpdateRequest request) {
    Questao questao = findById(id);

    // Detect changes
    boolean contentChanged = hasContentChanged(questao, request);

    // Direct repository call for side effect
    if (contentChanged) {
        respostaRepository.deleteByQuestaoId(id);  // Tightly coupled
    }

    // Update logic...
    return questaoMapper.toDetailDto(questaoRepository.save(questao));
}
```

**Issues:**
- Service classes become aware of side effects they shouldn't manage
- Hard to add new behaviors without modifying core services
- Difficult to test in isolation
- Violates Single Responsibility Principle

---

### Proposed Enhancement

**Use Spring Application Events for decoupled updates:**

#### Step 1: Define Domain Events

```java
package com.studora.backend.events;

import lombok.Getter;
import org.springframework.context.ApplicationEvent;

/**
 * Base class for all Studora domain events.
 */
public abstract class StudoraDomainEvent extends ApplicationEvent {
    @Getter
    private final Long entityId;

    protected StudoraDomainEvent(Object source, Long entityId) {
        super(source);
        this.entityId = entityId;
    }
}
```

#### Step 2: Publish Events from Services
Instead of direct calls, use `ApplicationEventPublisher` to broadcast changes.

#### Step 3: Create Event Listeners
Implement `@EventListener` components to handle side effects (e.g., deleting historical responses when a question changes).

---

## 2. API Versioning

### Current State
Completed.

---

## 3. Additional Enhancements

### 3.1 Query Performance Monitoring
Add query performance logging to identify slow queries as the database grows.

```java
// application.yml
spring:
  jpa:
    properties:
      hibernate:
        generate_statistics: true
        session:
          events:
            log:
              LOG_QUERIES_SLOWER_THAN_MS: 100
```

### 3.2 Health Check Endpoints
Add Spring Boot Actuator for application health monitoring.

```xml
<dependency>
    <groupId>org.springframework.boot</groupId>
    <artifactId>spring-boot-starter-actuator</artifactId>
</dependency>
```

### 3.3 Request/Response Logging Interceptor
Implement a `HandlerInterceptor` to log all API requests for debugging.

### 3.4 Database Connection Pooling Optimization
Tune HikariCP settings for the target database environment.

### 3.5 Custom Exception Handling Enhancement
Expand error handling with more specific exception types (e.g., `InsufficientQuestionsException`).

---

<a name="completed-enhancements"></a>
## Completed Enhancements

### ✅ Strict DTO Layer with MapStruct (Feb 2026)
- **Architecture:** Implemented a three-tier DTO pattern: `Request` (input), `Summary` (lists), and `Detail` (rich resource views).
- **Technology:** Fully integrated **MapStruct** for all 9 core entities.
- **Cleanup:** All legacy DTOs (`QuestaoDto`, `BancaDto`, etc.) and deprecated bridge methods removed.
- **Status:** 100% test coverage maintained across all refactored services and controllers.

### ✅ API Versioning (Feb 2026)
- **Architecture:** Implemented URL-based versioning using a global path prefix configuration.
- **Organization:** Moved all existing controllers to a `com.studora.controller.v1` package.
- **Configuration:** Used `WebMvcConfigurer.addPathPrefix` to automatically apply `/api/v1` to all v1 controllers, ensuring a clean and maintainable versioning strategy.
- **Compatibility:** Updated all 80+ integration and unit tests to reflect the new versioned paths.

---

## Implementation Priority

### High Priority
1. **Event-Driven Architecture** - Improves maintainability significantly.

### Medium Priority
2. **Health Check Endpoints** - Useful for monitoring.
3. **Query Performance Monitoring** - Helps identify bottlenecks.

---

## Success Criteria

### Event-Driven Architecture
- ✅ All cross-service side effects handled via events
- ✅ No direct service-to-service calls for side effects
- ✅ Events properly tested in isolation

### API Versioning
- ✅ Versioning structure in place (/api/v1 prefix via WebConfig)
- ✅ Migration path documented (controllers in v1 package)

---

## Revision History

| Date | Version | Changes | Author |
|------|---------|---------|--------|
| 2026-02-04 | 1.0 | Initial document creation | - |
| 2026-02-06 | 1.1 | Marked "Strict DTO Layer" as Completed; Restored original additional enhancements. | - |

---

**Last Updated:** February 6, 2026